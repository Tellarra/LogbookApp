<!doctype html>
<html>
<head>
<meta charset="utf-8">
<!--Import Google Icon Font-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!--Import materialize.css-->
<link type="text/css" rel="stylesheet" href="../css/materialize.css"  media="screen,projection"/>
<!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link type="text/css" rel="stylesheet" href="../css/mainStylesheet.css"/>
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../js/materialize.min.js"></script>

<!-- Signature plugin -->
<script src="../Plugins/jSignature/jSignature.min.js"></script>
<script src="../Plugins/validator/jquery.validate.js"></script>
<!-- Validator plugin -->
<script>
//Create Database
var createTableSQL = "CREATE TABLE IF NOT EXISTS tblSession (fldLogNo INTEGER PRIMARY KEY AUTOINCREMENT, fldName TEXT, fldLicenceNo TEXT, fldCarRego TEXT, fldDate DATE, fldStartTime TIME, fldFinishTime TIME, fldDrivingTime TEXT, fldOdometerStart TEXT, fldOdometerFinish TEXT, fldParking TEXT, fldLight TEXT, fldConditions TEXT);";
var insertSQL = "INSERT INTO tblSession (fldLogNo, fldName, fldLicenceNo, fldCarRego, fldDate, fldStartTime, fldFinishTime, fldDrivingTime, fldOdometerStart, fldOdometerFinish, fldParking, fldLight, fldConditions) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);";
var showSQL = "SELECT * FROM tblSession;";
var updateRecordSQL = "UPDATE tblSession SET fldStartTime=?, fldFinishTime=?, fldDrivingTime=?, fldOdometerStart=?, fldOdometerFinish=?, fldParking=?, fldLight=?, fldConditions=? WHERE fldLogNo= ?;";
var selectOtherTable = "SELECT tblSupervisor FROM Log Book WHERE type = 'table';";
var selectAllRecordSupervisor =  "SELECT * FROM tblSupervisor;";
var deleteSQL = "DELETE from tblSession WHERE fldLogNo=?;";
var	deleteAllSQL = "DELETE from tblSession";
var dropTable = "DROP TABLE tblSession";
var db = null;	
	
$(document).ready(function() {
	document.addEventListener("deviceready", onDeviceReady(), false);
	//NavBar
    $('.sidenav').sidenav();
	//Date picker
	$('.datepicker').datepicker();
	//Time Picker
	$('.timepicker').timepicker();
	//Select Button
	$('select').formSelect();
	//Put label on top of the text input
	//M.updateTextFields();
	//Signature
	$("#signature").jSignature();
	$("#clearButton").on("click", function() {
		$("#signature").jSignature("clear");
	});
});
	
var onDeviceReady = function() {
  console.log("In deviceready");
  try {
    if( !window.openDatabase )
      alert("This device does NOT support databases");
    else {
      /*var shortName = "Sessions";
      var version = "1";
      var displayName = "Sessions";
      var maxSize = 1024;*/
      db = window.openDatabase("Log Book", "1", "Log Book", "1024");
      console.log("Database opened");
      db.transaction(populateDB, onError);
    } // end else
  }
  catch(err) {
    console.log("Error: " + err);
  }
};
	
var populateDB = function(trans) {
  db.transaction(function(trans) {
	  trans.executeSql(createTableSQL,[]);
	  trans.executeSql(selectOtherTable,[]);

	  db.transaction(showRecords);
	 
	 //trans.executeSql(dropTable,[]);
	  console.log("Table created");
  }); // end of transaction
};
	
var showRecords = function() {
  console.log("In show records");
  db.transaction(function(trans){
	  console.log(selectAllRecordSupervisor);
	  trans.executeSql(selectAllRecordSupervisor,[], function(trans, result) {
      var str = "";
	console.log(result);
      	
      if( result.rows.length == 0 ) {
		  $("#selName").addClass("hiddendiv");
		  $("#divName").removeClass("hiddendiv");
      } else {
		$("#divName").addClass("hiddendiv");
		$("#selName").removeClass("hiddendiv");
        var noOfRecs = result.rows.length;
		var output = "";
		  
        for(var i = 0; i < noOfRecs; i++) {
          // saving row to a variable
          	var row = result.rows.item(i);
			console.log(row['fldName']);
			//output += "<select class='icons' id='selName'>";
			output += "<option value='" + row['fldName'] + "'>" + row['fldName'] + "</option>";
			//output += "</select>";
			
        }
		  console.log(output);
		 //$("#selName").material_select(output);
        $(".select-wrapper #selName").append(output);
		$(".select-wrapper #selName").formSelect();
        console.log("Name added to select");
      } // end else
    });
  });
};
	
var onError = function(err) {
	var str = "";
	switch(err.code)	{
		case	0:  str += "Non database error: " + err.message;
					break;
		case	1:	str += "Some database error: " + err.message;
					break;
		case	2:	str += "Wrong database version: " + err.message;
					break;
		case	3:	str += "Data set too large to return from query: " + err.message;
					break;
		case	4: 	str += "Storage limit exceeded: " + err.message;
					break;
		case	5:	str += "Lock contension error: " + err.message;
					break;
		case	6:	str += "Constraint failure: " + err.message;
					break;
		default	:	str += "Error: " + err.code + " " + err.message;
					break;
	}
	console.log(str);
}

var clearTxt = function clearTxt() {
  setTimeout(function(){$(".msg").html("");}, 1000);
}
	

</script>
<title>LogBook</title>
</head>

<body>
<div class="pages" id="page" data-theme="a" >
<nav>
    <div class="nav-wrapper">
      <a href="#!" class="center brand-logo">Log Book</a>
      <a href="../index.html" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons left">arrow_back</i></a>
      <ul class="left hide-on-med-and-down">
        <li><a href="../index.html" data-target="mobile-demo"><i class="material-icons left">arrow_back</i></a></li>
      </ul>
    </div>
  </nav>
 <h1 align="center">Enter your session's information</h1>
<div class="row">
	<form method="get" id="formValidate" class="col s12">
  		<div class="row">
				<div id="divName" class="input-field col s12">
			 	  <i class="material-icons prefix">card_membership</i>
				  <input id="txtName" type="text" class="validate">
				  <label for="txtName" class="active teal-text text-lighten-2">Learner's Name</label>
				  <span class="helper-text" ></span>
				</div>
			  </div>
			  <div class="input-field col s12 m6">
					<i class="material-icons prefix">people</i>
						<select class="icons" id="selName">
							
						</select>
					<label class="teal-text text-lighten-2">Supervisor's name</label>
			  </div>
		  <div class="row">
				<div class="input-field col s12">
			 	  <i class="material-icons prefix">card_membership</i>
				  <input id="txtLicenseNo" type="text" class="validate" required="">
				  <label for="txtLicenseNo" class="teal-text text-lighten-2">Supervisor's License Number</label>
				  <span class="helper-text"></span>
				</div>
			  </div>
			  <div class="row">
				<div class="input-field col s12">
			  		<i class="material-icons prefix">directions_car</i>
				  <input id="txtRegNo" type="text" class="validate" required aria-required="true">
				  <label for="txtRegNo" class="teal-text text-lighten-2">Car Registration Number</label>
				</div>
			</div>
			<!--<div class="input-field col s12 m6 hiddendiv">
   				<i class="material-icons prefix">directions_car</i>
    			<select class="icons">
      				<option value="" disabled selected>James' Car</option>
      				<option value="Day">Day</option>
   	 			</select>
    			<label class="teal-text text-lighten-2">Choose your car</label>
  			</div>-->
			<div class="row">
				<div class="input-field col s12">
			  		<i class="material-icons prefix">event</i>
				  <input id="txtDate" type="text" class="datepicker">
				  <label for="txtDate" class="teal-text text-lighten-2">Date</label>
				</div>
			</div>
			  <div class="row">
				<div class="input-field col s12">
			 		<i class="material-icons prefix">access_time</i>
				  <input id="txtStartTime" type="text" class="timepicker">
				  <label for="txtStartTime" class="teal-text text-lighten-2">Start time</label>
				</div>
			  </div>
			  <div class="row">
				<div class="input-field col s12">
			  		<i class="material-icons prefix">av_timer</i>
				  <input id="txtFinishTime" type="text" class="timepicker">
				  <label for="txtFinishTime" class="teal-text text-lighten-2">Finish time</label>
				</div>
			  </div>
			  <div class="row">
				<div class="input-field col s12">
			  		<img src="../images/icons8-png/icons8-au-volant-filled-50.png" class="prefix" style="width: 24px; height: 24px;">
				  <input id="txtTime" type="text" class="validate">
				  <label for="txtTime" class="teal-text text-lighten-2">Driving Time</label>
				</div>
			  </div>
			  <div class="row">
				<div class="input-field col s12">
			  		<img src="../images/icons8-png/icons8-odomètre-50.png" class="prefix" style="width: 24px; height: 24px;">
				  <input id="txtOdom" type="text" class="validate">
				  <label for="txtOdom" class="teal-text text-lighten-2">Odometer Before Driving</label>
				</div>
			  </div>
			  <div class="row">
				<div class="input-field col s12">
			  		<img src="../images/icons8-png/icons8-odomètre-filled-50.png" class="prefix" style="width: 24px; height: 24px;">
				  <input id="txtOdomAfter" type="text" class="validate">
				  <label for="txtOdomAfter" class="teal-text text-lighten-2">Odometer After Driving</label>
				</div>
			  </div>
			   <div class="row">
				<div class="input-field col s12">
			 	  <i class="material-icons prefix">directions_car</i>
				  <input id="txtParking" type="text" class="validate" required="">
				  <label for="txtParking" class="teal-text text-lighten-2">Parking</label>
				  <span class="helper-text"></span>
				</div>
			  </div>
			  <div class="input-field col s12 m6">
   				<i class="material-icons prefix">wb_sunny</i>
    			<select class="icons">
      				<option value="" disabled selected>Choose your option</option>
      				<option value="Day">Day</option>
      				<option value="Night">Night</option>
      				<option value="Day and Night">Day and Night</option>
   	 			</select>
    		<label class="teal-text text-lighten-2">Light</label>
  			</div>
  			<div class="input-field col s12">
  			<img src="../images/icons8-png/icons8-route-filled-50.png" class="prefix" style="width: 24px; height: 24px;">
				<select multiple>
				  <option value="" disabled selected>Choose your options</option>
				  <optgroup label="Traffic">
					  <option value="Light">Light</option>
					  <option value="Moderate">Moderate</option>
					  <option value="Heavy">Heavy</option>
				  </optgroup>
				  <optgroup label="Weather">
					  <option value="Dry">Dry</option>
					  <option value="Wet">Wet</option>
				  </optgroup>
				  <optgroup label="Road">
					  <option value="Local Street">Local Street</option>
					  <option value="Main Road">Main Road</option>
					  <option value="Inner City">Inner City</option>
					  <option value="Freeway">Freeway</option>
					  <option value="Rural Hwy">Rural Hwy</option>
					  <option value="Rural Other">Rural Other</option>
					  <option value="Gravel">Gravel</option>
				  </optgroup>
				</select>
				<label class="teal-text text-lighten-2">Conditions</label>
			  </div>
			  <div class="row">
				  <div class="input-field col s12">
					<p class="teal-text text-lighten-2">Signature</p>
					<div id="signature"></div>
					<p>
			  			<button class="waves-effect waves-light btn" type="button" id="clearButton">Clear</button>
			  		</p>
				  </div>
			  </div>
			  <div class="input-field col s12">
			  <div class="right">
			  	<button class="waves-effect waves-light btn" type="reset" id="resetButton">Reset</button>
			  	<button class="btn waves-effect waves-light red accent-4" type="submit" name="action">Submit
    				<i class="material-icons right">send</i>
  				</button>
  			  </div>
  			  </div>
			</form>
		</div>
	</div>
</body>
</html>
